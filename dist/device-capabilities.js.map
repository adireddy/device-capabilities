{
"version":3,
"file":"device-capabilities.js",
"sourceRoot":"file:///",
"sources":["/projects/device-capabilities/src/BatterySupport.hx","/projects/device-capabilities/src/Motion.hx","/usr/local/lib/haxe/std/js/_std/Reflect.hx","/projects/device-capabilities/src/Vibration.hx"],
"sourcesContent":["import js.Browser;\nimport js.html.BatteryManager;\nimport js.html.Navigator;\n\n@:expose @:keep class BatterySupport {\n\n    public var isSupported:Bool;\n    public var battery:BatteryManager;\n\n    var _navigator:Navigator;\n\n    public function new(?ready:Void -> Void) {\n        _navigator = Browser.navigator;\n        battery = _navigator.battery;\n        if (battery == null) battery = Reflect.field(_navigator, \"webkitBattery\");\n        if (battery == null) battery = Reflect.field(_navigator, \"mozBattery\");\n        isSupported = (battery != null);\n        if (battery == null && Reflect.field(_navigator, \"getBattery\") != null) {\n            untyped __js__(\"window.navigator\").getBattery().then(function(b) {\n                battery = b;\n                isSupported = true;\n                if (ready != null) ready();\n            });\n        }\n        else {\n            if (ready != null) ready();\n        }\n    }\n}","import js.html.DeviceMotionEvent;\nimport js.html.Window;\nimport js.Browser;\n\n@:keep @:expose class Motion {\n\n    var _window:Window;\n    var _x:Float;\n    var _y:Float;\n    var _z:Float;\n    var _time:Float;\n    var _threshold:Int;\n    var _interval:Int;\n    var _callback:Void -> Void;\n\n    public function new() {\n        _window = Browser.window;\n    }\n\n    public function shake(callback:Void -> Void, ?threshold:Int = 10, ?interval:Int = 1000) {\n        _reset();\n        _threshold = threshold;\n        _interval = interval;\n        _callback = callback;\n        _time = Date.now().getTime();\n        _window.addEventListener(\"devicemotion\", _onDeviceMotion);\n    }\n\n    public function stopShake() {\n        _window.removeEventListener(\"devicemotion\", _onDeviceMotion);\n        _callback = null;\n        _reset();\n    }\n\n    function _onDeviceMotion(evt:DeviceMotionEvent) {\n        if (_x == null || _y == null || _z == null) {\n            _x = evt.accelerationIncludingGravity.x;\n            _y = evt.accelerationIncludingGravity.y;\n            _z = evt.accelerationIncludingGravity.z;\n            return;\n        }\n\n        var diffX = Math.abs(_x - evt.accelerationIncludingGravity.x);\n        var diffY = Math.abs(_y - evt.accelerationIncludingGravity.x);\n        var diffZ = Math.abs(_z - evt.accelerationIncludingGravity.x);\n\n        if ((diffX > _threshold && diffY > _threshold) || (diffX > _threshold && diffZ > _threshold) || (diffY > _threshold && diffZ > _threshold)) {\n            if (Date.now().getTime() - _time > _interval) {\n                _callback();\n                _time = Date.now().getTime();\n            }\n        }\n\n        _x = evt.accelerationIncludingGravity.x;\n        _y = evt.accelerationIncludingGravity.y;\n        _z = evt.accelerationIncludingGravity.z;\n    }\n\n    inline function _reset() {\n        _x = null;\n        _y = null;\n        _z = null;\n        _time = null;\n    }\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class Reflect {\n\n\tpublic inline static function hasField( o : Dynamic, field : String ) : Bool {\n\t\treturn untyped __js__('Object').prototype.hasOwnProperty.call(o, field);\n\t}\n\n\tpublic static function field( o : Dynamic, field : String ) : Dynamic {\n\t\ttry return untyped o[field] catch( e : Dynamic ) return null;\n\t}\n\n\tpublic inline static function setField( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\to[field] = value;\n\t}\n\n\tpublic static inline function getProperty( o : Dynamic, field : String ) : Dynamic untyped {\n\t\tvar tmp;\n\t\treturn if( o == null ) __define_feature__(\"Reflect.getProperty\",null) else if( o.__properties__ && (tmp=o.__properties__[\"get_\"+field]) ) o[tmp]() else o[field];\n\t}\n\n\tpublic static inline function setProperty( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\tvar tmp;\n\t\tif( o.__properties__ && (tmp=o.__properties__[\"set_\"+field]) ) o[tmp](value) else o[field] = __define_feature__(\"Reflect.setProperty\",value);\n\t}\n\n\tpublic inline static function callMethod( o : Dynamic, func : haxe.Constraints.Function, args : Array<Dynamic> ) : Dynamic untyped {\n\t\treturn func.apply(o,args);\n\t}\n\n\tpublic static function fields( o : Dynamic ) : Array<String> {\n\t\tvar a = [];\n\t\tif (o != null) untyped {\n\t\t\tvar hasOwnProperty = __js__('Object').prototype.hasOwnProperty;\n\t\t\t__js__(\"for( var f in o ) {\");\n\t\t\tif( f != \"__id__\" && f != \"hx__closures__\" && hasOwnProperty.call(o, f) ) a.push(f);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a;\n\t}\n\n\tpublic static function isFunction( f : Dynamic ) : Bool untyped {\n\t\treturn __js__(\"typeof(f)\") == \"function\" && !(js.Boot.isClass(f) || js.Boot.isEnum(f));\n\t}\n\n\tpublic static function compare<T>( a : T, b : T ) : Int {\n\t\treturn ( a == b ) ? 0 : (((cast a) > (cast b)) ? 1 : -1);\n\t}\n\n\tpublic static function compareMethods( f1 : Dynamic, f2 : Dynamic ) : Bool {\n\t\tif( f1 == f2 )\n\t\t\treturn true;\n\t\tif( !isFunction(f1) || !isFunction(f2) )\n\t\t\treturn false;\n\t\treturn f1.scope == f2.scope && f1.method == f2.method && f1.method != null;\n\t}\n\n\tpublic static function isObject( v : Dynamic ) : Bool untyped {\n\t\tif( v == null )\n\t\t\treturn false;\n\t\tvar t = __js__(\"typeof(v)\");\n\t\treturn (t == \"string\" || (t == \"object\" && v.__enum__ == null)) || (t == \"function\" && (js.Boot.isClass(v) || js.Boot.isEnum(v)) != null);\n\t}\n\n\tpublic static function isEnumValue( v : Dynamic ) : Bool {\n\t\treturn v != null && v.__enum__ != null;\n\t}\n\n\tpublic static function deleteField( o : Dynamic, field : String ) : Bool untyped {\n\t\tif( !hasField(o,field) ) return false;\n\t\t__js__(\"delete\")(o[field]);\n\t\treturn true;\n\t}\n\n\tpublic static function copy<T>( o : T ) : T {\n\t\tvar o2 : Dynamic = {};\n\t\tfor( f in Reflect.fields(o) )\n\t\t\tReflect.setField(o2,f,Reflect.field(o,f));\n\t\treturn o2;\n\t}\n\n\t@:overload(function( f : Array<Dynamic> -> Void ) : Dynamic {})\n\tpublic static function makeVarArgs( f : Array<Dynamic> -> Dynamic ) : Dynamic {\n\t\treturn function() {\n\t\t\tvar a = untyped Array.prototype.slice.call(__js__(\"arguments\"));\n\t\t\treturn f(a);\n\t\t};\n\t}\n\n}\n","import js.html.Navigator;\nimport js.Browser;\n\n// Chrome & Firefox only\n@:expose @:keep class Vibration {\n\n    public var isSupported:Bool;\n\n    var _navigator:Navigator;\n\n    public function new() {\n        _navigator = Browser.navigator;\n        isSupported = (Browser.window != null && _navigator.vibrate != null);\n    }\n\n    public function start(?duration:Int = 1000) {\n        if (isSupported) _navigator.vibrate(duration);\n    }\n\n    public function startPattern(pattern:Array<Int>) {\n        if (isSupported) _navigator.vibrate(pattern);\n    }\n\n    public function stop() {\n        if (isSupported) _navigator.vibrate(0);\n    }\n}"],
"names":[],
"mappings":";6BAWU,bAAkC;CAAlC;CACH,EAAa;CACb,EAAU;CACV,CAAI,EAAW,HAAM,EAAU,FAAc,AAAY;CACzD,CAAI,EAAW,HAAM,EAAU,FAAc,AAAY;CACzD,EAAc,AAAC,CAAW;CAC1B,CAAI,EAAW,AAAQ,HAAc,AAAY,GAAiB,HACtD,AAA6C,WAAY;EAC7D,CAAU;EACV,CAAc;EACd,AAAI,EAAS,HAAM;MAIvB,JAAI,EAAS,HAAM;;qBCVpB,VACH;GAAU;;;OAGP;;;EACH;;;;EACA,CAAa;EACb,CAAY;EACZ,CAAY;EACZ,CAAQ;EACR,DAAyB,AAAgB;;WAGtC,AAAqB;EACxB,DAA4B,AAAgB;EAC5C,CAAY;EACZ;;;;;iBAGJ,HAAgD;EAC5C,AAAI,EAAM,AAAQ,AAAM,AAAQ,AAAM,HAAM;GACxC,AAAK;GACL,AAAK;GACL,AAAK;GACL;;EAGQ,DAAS,EAAK;EACd,DAAS,EAAK;EACd,DAAS,EAAK;EAE1B,AAAI,DAAC,EAAQ,CAAc,DAAQ,CAAe,AAAC,DAAQ,CAAc,DAAQ,CAAe,AAAC,DAAQ,CAAc,DAAQ,FAC3H;EAAI,CAAuB,AAAQ,FAAW;IAC1C;IACA,DAAQ;;;EAIhB,CAAK;EACL,CAAK;EACL,CAAK;;QAGF,GAAkB;EACrB,CAAK;EACL,CAAK;EACL,CAAK;EACL,CAAQ;;;;gBCnCD,EACb;IAAI;OAAe,NAAE;;EAA4B,KAAO;;;wBClB/C,bAAe;CAClB,EAAa;CACb,EAAc,AAAC,CAAkB,AAAQ,AAAsB;;;OAG5D;;EACH,AAAI,DAAa,AAAmB;;cAGjC,IACH;EAAI,DAAa,AAAmB;;MAGjC,KACH;EAAI,DAAa,AAAmB;;;;;;;"
}